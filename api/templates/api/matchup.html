<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>matchup</title>


      <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="{% static 'main.css' %}"/>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  </head>
  <body>
    <div class="match_container">
      <div class="player_a">
        <h2>{{ a }}</h2>
        <!-- Claim user button -->
        {% if request.user.is_authenticated %}
          {% if comp_a.user_id %}
            <!-- Show Nothing if id is assigned -->
          {% else %}
            <button class="me_button" onclick="claim_competitor({{a_id}})">This is me!</button>
          {% endif %}
        {% endif %}

        <!-- Declar winner button -->
        {% if bracket_permissions %}
          {% if winner == None %}
            <h2> Here </h2>
          {% elif %}
            <h2> Other </h2>
          {% endif %}
        {% endif %}

      </div>
      <div class="vs">
        <h2>vs</h2>
      </div>
      <div class="player_b">
        <h2>{{ b }}</h2>
          {% if request.user.is_authenticated %}
            {% if comp_b.user_id %}
              <!-- Show Nothing -->
            {% else %}
              <button class="me_button" onclick="claim_competitor({{b_id}})">This is me!</button>
            {% endif %}
          {% endif %}
      </div>
    </div>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>
    function claim_competitor(competitor) {
                var user_id = {{ user.id }}
                  $.ajaxSetup({
                     beforeSend: function(xhr, settings) {
                         function getCookie(name) {
                             var cookieValue = null;
                             if (document.cookie && document.cookie != '') {
                                 var cookies = document.cookie.split(';');
                                 for (var i = 0; i < cookies.length; i++) {
                                     var cookie = jQuery.trim(cookies[i]);
                                     // Does this cookie string begin with the name we want?
                                     if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                         break;
                                     }
                                 }
                             }
                             return cookieValue;
                         }
                         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                             // Only send the token to relative URLs i.e. locally.
                             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                         }
                     }
                });
                $.ajax({
                  async: false,
                  url: "/" + "claim_competitor/" + competitor,
                  type: "PUT",
                  headers: {
                      "Authorization": "Basic " + btoa("admin:password")
                    },
                  data: {
                      "user_id": user_id
                      }
                  }).success(
                    window.location = "/matchup/" + {{ bracket_id }} + "/" + {{ parent_id }}
                  );
                };
  </script>
</html>
